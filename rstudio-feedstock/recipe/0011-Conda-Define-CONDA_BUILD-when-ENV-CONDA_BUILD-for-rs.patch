From 5f8c9196093923637e70cf063b58f8b43718babd Mon Sep 17 00:00:00 2001
From: Ray Donnelly <mingw.android@gmail.com>
Date: Wed, 28 Mar 2018 21:29:26 +0100
Subject: [PATCH 11/38] Conda: Define CONDA_BUILD when ENV{CONDA_BUILD} for
 rstudio and rsession

---
 src/cpp/core/CMakeLists.txt    | 4 ++++
 src/cpp/session/CMakeLists.txt | 4 ++++
 2 files changed, 8 insertions(+)

diff --git a/src/cpp/core/CMakeLists.txt b/src/cpp/core/CMakeLists.txt
index f50d4689e7..75b36bbd19 100644
--- a/src/cpp/core/CMakeLists.txt
+++ b/src/cpp/core/CMakeLists.txt
@@ -347,6 +347,10 @@ target_link_libraries(
    ${CORE_SYSTEM_LIBRARIES}
 )
 
+if(DEFINED ENV{CONDA_BUILD})
+   target_compile_definitions(rstudio-core PRIVATE "-DCONDA_BUILD")
+endif()
+
 # define executable (for running unit tests)
 if (RSTUDIO_UNIT_TESTS_ENABLED)
 
diff --git a/src/cpp/session/CMakeLists.txt b/src/cpp/session/CMakeLists.txt
index 76f310b994..ef2281b17d 100644
--- a/src/cpp/session/CMakeLists.txt
+++ b/src/cpp/session/CMakeLists.txt
@@ -389,6 +389,10 @@ if(RSTUDIO_DEVELOPMENT OR RSTUDIO_RUN_IN_PLACE)
    set_target_properties(rsession PROPERTIES SKIP_BUILD_RPATH TRUE)
 endif()
 
+if(DEFINED ENV{CONDA_BUILD})
+   target_compile_definitions(rsession PRIVATE "-DCONDA_BUILD")
+endif()
+
 # add origin rpath for suse/sles
 if(RSTUDIO_PACKAGE_VARIANT STREQUAL "SLES")
    set(CMAKE_BUILD_WITH_INSTALL_RPATH TRUE)
-- 
2.23.0

