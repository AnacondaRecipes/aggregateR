From 0a91debc1eaea7cf969954a0d008c7c92d64d70b Mon Sep 17 00:00:00 2001
From: Ray Donnelly <mingw.android@gmail.com>
Date: Mon, 31 Oct 2016 12:18:41 +0000
Subject: [PATCH 17/40] Conda (macOS): Use bundleIdentifier to detect running from bundle

.. instead of whether or not Info.plist exists as bundleIdentifier
is more reliable (esp. when debugging).

In conda both running rstudio executable directly or from an App
bundle are supported.
---
 src/cpp/desktop-mac/AppDelegate.mm |    3 ++-
 1 files changed, 2 insertions(+), 1 deletions(-)

diff --git a/src/cpp/desktop-mac/AppDelegate.mm b/src/cpp/desktop-mac/AppDelegate.mm
index 1f38a96..3629140 100644
--- a/src/cpp/desktop-mac/AppDelegate.mm
+++ b/src/cpp/desktop-mac/AppDelegate.mm
@@ -293,6 +293,7 @@ bool prepareEnvironment(Options& options)
 {
    // check for open file request (either apple event or command line)
    NSString* openFile = verifyAndNormalizeFilename(openFile_);
+   NSString* bundleId = [[NSRunningApplication currentApplication] bundleIdentifier];
    if (!openFile)
    {
       openFile = openFileCommandLineArgument();
@@ -355,7 +356,7 @@ bool prepareEnvironment(Options& options)
       scriptsPath = installPath.complete("bin");
       
       // check for running in a bundle
-      if (installPath.complete("Info.plist").exists())
+      if (bundleId != nil && !sessionPath.exists())
       {
          sessionPath_ = installPath.complete("MacOS/rsession");
          scriptsPath = installPath.complete("MacOS");
-- 
1.7.1

