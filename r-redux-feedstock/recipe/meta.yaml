{% set version = '1.1.3' %}

{% set posix = 'm2-' if win else '' %}
{% set native = 'm2w64-' if win else '' %}

package:
  name: r-redux
  version: {{ version|replace("-", "_") }}

source:
  url:
    - {{ cran_mirror }}/src/contrib/redux_{{ version }}.tar.gz
    - {{ cran_mirror }}/src/contrib/Archive/redux/redux_{{ version }}.tar.gz
  sha256: 3d912f8f78f9a4f9d2eec35fb48f520987b768b1e2018cd743073a68bf1276ad

build:
  merge_build_host: True  # [win]
  # If this is a new build for the same version, increment the build number.
  number: 0
  # no skip

  # This is required to make R link correctly on Linux.
  rpaths:
    - lib/R/lib/
    - lib/

# Suggests: knitr, rmarkdown, sys, testthat
requirements:
  build:
    - {{ compiler('c') }}              # [not win]
    - {{ compiler('m2w64_c') }}        # [win]
    - {{ posix }}filesystem        # [win]
    - {{ posix }}sed               # [win]
    - {{ posix }}grep              # [win]
    - {{ posix }}autoconf
    - {{ posix }}automake          # [not win]
    - {{ posix }}automake-wrapper  # [win]
    - {{ posix }}pkg-config
    - {{ posix }}make
    - {{ posix }}coreutils         # [win]
    - {{ posix }}zip               # [win]

  host:
    - r-base
    - r-r6
    - r-storr >=1.1.1
    - hiredis

  run:
    - r-base
    - {{native}}gcc-libs         # [win]
    - r-r6
    - r-storr >=1.1.1
    - hiredis

test:
  commands:
    # You can put additional test commands to be run here.
    - $R -e "library('redux')"           # [not win]
    - "\"%R%\" -e \"library('redux')\""  # [win]

  # You can also put a file called run_test.py, run_test.sh, or run_test.bat
  # in the recipe that will be run at test time.

  # requires:
    # Put any additional test requirements here.

about:
  home: https://github.com/richfitz/redux
  license: GPL-2
  summary: A 'hiredis' wrapper that includes support for transactions, pipelining, blocking subscription,
    serialisation of all keys and values, 'Redis' error handling with R errors. Includes
    an automatically generated 'R6' interface to the full 'hiredis' API.  Generated
    functions are faithful to the 'hiredis' documentation while attempting to match
    R's argument semantics.  Serialisation must be explicitly done by the user, but
    both binary and text-mode serialisation is supported.
  license_family: GPL2
  license_file:
    - '{{ environ["PREFIX"] }}/lib/R/share/licenses/GPL-2'

# The original CRAN metadata for this package was:

# Package: redux
# Title: R Bindings to 'hiredis'
# Version: 1.1.3
# Authors@R: c(person("Rich", "FitzJohn", role = c("aut", "cre"), email = "rich.fitzjohn@gmail.com"))
# Description: A 'hiredis' wrapper that includes support for transactions, pipelining, blocking subscription, serialisation of all keys and values, 'Redis' error handling with R errors. Includes an automatically generated 'R6' interface to the full 'hiredis' API.  Generated functions are faithful to the 'hiredis' documentation while attempting to match R's argument semantics.  Serialisation must be explicitly done by the user, but both binary and text-mode serialisation is supported.
# SystemRequirements: hiredis
# License: GPL-2
# URL: https://github.com/richfitz/redux
# BugReports: https://github.com/richfitz/redux/issues
# Depends: R (>= 3.2.0)
# Imports: R6, storr (>= 1.1.1)
# Suggests: knitr, rmarkdown, sys, testthat
# VignetteBuilder: knitr
# RoxygenNote: 7.1.2
# Encoding: UTF-8
# NeedsCompilation: yes
# Packaged: 2022-01-11 10:42:42 UTC; rich
# Author: Rich FitzJohn [aut, cre]
# Maintainer: Rich FitzJohn <rich.fitzjohn@gmail.com>
# Repository: CRAN
# Date/Publication: 2022-01-12 11:22:42 UTC

# See
# https://docs.conda.io/projects/conda-build for
# more information about meta.yaml
